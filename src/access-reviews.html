<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymerfire/polymerfire.html">
<link rel="import" href="access-review.html">
<link rel="import" href="access-button.html">

<dom-module id="access-reviews">
	<template>
		<style include="access-button">
			.add-review {
				width: 100%;
				display: flex;
				justify-content: center;
				margin: 20px auto;
			}

			.reviews {
				display: flex;
				flex-wrap: wrap;
				justify-content: flex-start;
				margin-bottom: 4em;
			}

			access-review {
				margin: 20px;
			}


			@media (max-width: 800px) {
				.reviews {
					justify-content: flex-start;
				}
			}
		</style>

		<firebase-query
			id="reviewsQuery"
			app-name="restaurants"
			path="/restaurants/[[restId]]/reviews"
			data="{{reviewsData}}">
		</firebase-query>

		<firebase-document
			id="reviewDoc"
			app-name="restaurants"
			path="{{reviewPath}}"
			data="{{reviewData}}">
		</firebase-document>
		
		<section class="add-review">
			<access-button>
				<button on-tap="openModal">Add Review</button>
			</access-button>
		</section>

		<section class="reviews">
			<template is="dom-repeat" items="[[reviews]]" as="review">
				<access-review
					name="[[review.name]]"
					stars="[[review.stars]]"
					comments="[[review.comments]]"></access-review>
			</template>
		</section>
	</template>
	<script>
		
	Polymer({

		is: 'access-reviews',

		properties: {
			restId: {
				type: String,
				notify: true
			},
			reviewsData: {
				notify: true,
				observer: '_updateReviews'
			},
			reviews: {
				notify: true
			}
		},

		_updateReviews: function(newVal, oldVal) {
			this.reviews = oldVal;
		},

		addReview: function() {
			var d = new Date();
			this.reviewData = {
				name: 'Sir Ristorante',
				date: d,
				stars: 5,
				comments: 'Simply exquisite.'
			};

			this.$.reviewDoc.save('/restaurants/' + this.restId + '/reviews');
			this.$.reviewDoc.path = null;
		},

		openModal: function() {
			this.fire('open');
		}

	});

	</script>
</dom-module>